= Rancher RBAC
:description: SUSE Observability Self-hosted

== Overview

The SUSE Rancher Prime Observability Extension uses Kubernetes RBAC to grant access to Rancher users in SUSE Observability.
If you do not use Rancher, look at xref:/setup/security/rbac/rbac_roles.md[How to set up roles] in a standalone installation.

Two kinds of roles are used for accessing SUSE Observability:
* A _scope role_ (Observer) grants access to data - either all data in a SUSE Observability instance, data coming from a cluster, or just the data for a namespace. This role is provisioned in a cluster to be observed.
* An _instance role_ grants permissions to access or modify functionality of SUSE Observability itself.

A number of `RoleTemplate`s are available to achieve this, with common groupings of permissions. Binding these templates to users or groups on a cluster or namespace will trigger roles and role-bindings to be provisioned on the target cluster. The default templates are described below. Note that it is possible to define your own combinations of permissions in a custom RoleTemplate.

=== Observer role

The observer role grants a user the permission to read topology, metrics, logs and trace data for a namespace or a cluster. There are three `RoleTemplate`s that grant access to observability data:

* *Observer* - grants access to data coming from namespaces in a Project. This can be used in the "Project Membership" section of the cluster configuration.
* *Cluster Observer* - grants access to all data coming from a Cluster. This template can be used in the "Cluster Membership" section of the cluster configuration.
* *Instance Observer* - grants access to all data in a SUSE Observability instance. This template can be used on the Project that includes SUSE Observability itself.

In order to use these observer roles, it is recommended that the following role is granted on the Project running SUSE Observability itself:
* *Recommended Access* - has recommended permissions for using SUSE Observability.

=== Instance roles

There are two roles predefined in SUSE Observability, allowing for configuring the system - setting up views, monitors, notifications etcetera:
As these concern "global" settings of SUSE Observability, these roles include access to all data in an observability instance.

* *Instance Troubleshooter* - has all permissions required to use SUSE Observability for troubleshooting, including the ability to enable/disable monitors, create custom views and use the Cli.
* *Instance Administrator* - has full access to all views and has all permissions.

The permissions assigned to each predefined SUSE Observability role can be found below. For details of the different permissions and how to manage them using the `sts` CLI, see link:/setup/security/rbac/rbac_permissions.md[Role based access control (RBAC) permissions]

[tabs]
====
Recommended Access::
+
--
Recommended access grants permissions that are not strictly necessary, but that make SUSE Observability a lot more useful.

|===
|Resource |Verbs 

|api-tokens |get
|favorite-dashboards |create, delete
|favorite-views |create, delete
|stackpacks |get 
|visualization-settings |update
|===

--
Troubleshooter::
+
--
The Troubleshooter role has access to all data available in SUSE Observability and the ability to create views and enable/disable monitors.

|===
|Resource |Verbs 

|agents |get 
|api-tokens |get
|component-actions |execute
|dashboards |get, create, update, delete 
|favorite-dashboards |create, delete
|favorite-views |create, delete
|metric-bindings |get
|metrics |get 
|monitors |get, create, update, delete, execute 
|notifications |get, create, update, delete 
|settings |get 
|stackpack-configurations |get, create, update, delete
|stackpacks |get 
|system-notifications |get
|topology |get 
|traces |get 
|views |get, create, update, delete 
|visualization-settings |get
|===

--
Administrator::
+
--
The Administrator role has all permissions assigned.

|===
|Resource |Verbs 

|agents |get 
|api-tokens |get
|component-actions |execute
|dashboards |get, create, update, delete 
|favorite-dashboards |create, delete
|favorite-views |create, delete
|ingestion-api-keys |get, create, update, delete
|metric-bindings |get
|metrics |get 
|monitors |get, create, update, delete, execute 
|notifications |get, create, update, delete 
|permissions |get, create, update, delete 
|restricted-scripts |execute
|service-tokens |get, create, update, delete
|settings |get, create, update, delete, unlock 
|stackpack-configurations |get, create, update, delete
|stackpacks |get, create 
|sync-data |get, update, delete
|system-notifications |get
|topic-messages |get
|topology |get 
|traces |get 
|views |get, create, update, delete 
|visualization-settings |update
|===

--
====

=== Resource details

These resources correspond to those of xref:/setup/security/rbac/rbac_permissions.adoc[RBAC Permissions].  In particular *scoped permissions* apply to data collected by the SUSE Observability agent and access should typically be limited on a cluster or a namespace level. The following resources are available in the `scope.observability.cattle.io` API Group:

* `topology` - components (deployments, pods, etcetera) from the cluster or namespace
* `traces` - spans from the cluster or namespace
* `metrics` - metric data originating from the cluster or namespace

These resources can only be read, so the only applicable verb is `get`.

Other permissions, those that are not *scoped*, define user capabilities and access to various parts of SUSE Observability.  These "system permissions" allow e.g. executing queries or scripts and configuring SUSE Observability.  Those are collected from the `instance.observability.cattle.io` API Group.

=== Custom roles

In order to grant additional permissions in addition to Recommended Access, create a custom Project `RoleTemplate` in Rancher, inheriting from "SUSE Observability Instance Recommended Access".  Then to e.g. grant the rights to view monitors and metric charts, add rules with

* Verb: `get`
* Resource: `metricbindings` and `monitors`
* ApiGroup: `instance.observability.cattle.io`

image::rancher-custom-role.png[Custom RoleTemplate for richer access]

Any resource and verb combination that is defined in the xref:/setup/security/rbac/rbac_permissions.adoc[RBAC Permissions] can be specified.  Note that the dashes (`-`) are dropped from resource names, so the permission `get-metric-bindings` becomes the Kubernetes RBAC resource `metricbindings` with the verb `get`.